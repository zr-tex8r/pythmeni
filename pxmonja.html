<!DOCTYPE html public "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/transitional.dtd">
<html lang="ja">
<head>
<title>PXmonja パッケージ ～日本語を等幅で組む～ [電脳世界の奥底にて]</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<link rel="stylesheet" href="lib/zrmain.css" type="text/css">
<meta name="keywords" content="等幅,フォント,TeX,dvipdfmx,upTeX,dviout,LaTeX,pTeX,pLaTeX,upLaTeX">
<style type="text/css"><!--
--></style>
<script type="text/javascript" src="lib/jquery-1.3.2.min.js"></script>
<script type="text/javascript" src="lib/zrmain.js"></script>
<script type="text/javascript" defer src="cgiruby/zrcounter.cgi?name=pxmonja"></script>
<script type="text/javascript"><!--
//--></script>
</head>
<body>

<div id="canvas"><!--************************************************-->
<div id="main">

<div id="header">
<table id="site-title"><tr>
<td id="site-title-g">
<img src="image0/texno2.jpg" width="120" height="48"
     alt="ΕΝ Τ&#x1ffc; ΠΥΘΜΕΝΙ ΤΗΣ ΤΕΧΝΟΠΟΛΕΩΣ">
</td>
<td id="site-title-t">
<div id="title">
<span class="lgc">En toi Pythmeni tes TeXnopoleos</span><br>
<span class="ja">［電脳世界の奥底にて］</span>
</div>
</td>
</tr></table>
</div><!--header-->

<div id="navibar">
<span id="navilang">
| <span class="na">en</span>
| <span class="here">ja</span> |
</span>&nbsp;
<a href="./index.html">トップ</a> &gt;
<span class="here">PXmonja パッケージ</span>
</div><!--navibar-->


<div id="move-notice-mini">
「インフォシーク isweb ライト」サービス終了に伴い、
本サイトは以下のURLに移転することになりました。<br>
現在のサイトは、<em>10月末</em>を以て終了となります。<br>
<a href="http://zrbabbler.sp.land.to/pxmonja.html">http://zrbabbler.sp.land.to/pxmonja.html</a>
</div>
<div id="maintext">
<h1>PXmonja パッケージ<br>
<span class="subtitle">～日本語を等幅で組む～</span></h1>

<div class="abstract">
PXmonja パッケージは、端末表示を模したいわゆる「等幅」出力、すなわち
「欧文を和文の半分の幅にしてベタ組」する機能を提供する。
Verbatim 出力でもそれ以外でも使用可能である。
</div>

<div id="table-contents"></div>

<div class="section" id="sec-overview">
<h2>概要</h2>

<p>この文書およびパッケージにおいては、「等幅出力」を
「欧文を和文の半分の幅にしてベタ組」の意味で用いることにする。
コンピュータの画面上の文字出力がプロポーショナルフォントで行われるのが
普通になった現在においても、この意味での「等幅出力」
は様々な場面でなお使われ続けている。
例えば、コマンドシェル等のいわゆる CUI の画面、
あるいは専らプログラムソースを編集するためのテキストエディタでの
文字表示は等幅で行われるのが普通である。
従って、そのような環境を前提として作られた文書を出力するために、
LaTeX でも等幅出力が必要になる場合がある。
</p>
<p>欧文のみの場合は、verbatim 出力により等幅出力が実現される。
ところが、pLaTeX の和文処理の場合、verbatim 出力は先に述べた意味での
「等幅出力」になっていない。
これに対して、verbatim 環境を改造して「等幅出力」
を実現する等の方策がこれまで採られてきたようである。
しかしこの方法は、verbatim に対する拡張と共存できず、
また verbatim でない等幅出力（つまり <code>\ttfamily</code> の日本語版）
では使えないという欠点をもつ。
</p>
<p>PXmonja パッケージでは、「等幅出力」のための和文と欧文フォントの組
（この字形はともに日本語用フォントのものを使う）を用意する。
従って、このフォントに切り替えることにより、
欧文用の等幅出力機能が和文でも等幅として機能させられる。
</p>

<div class="subsection" id="ssec-environ">
<h3>対応環境</h3>
<ul>
<li>TeX 処理系： pLaTeX2e ／ upLaTeX2e
</li>
<li>DVI ウェア： dvipdfmx ／ dviout
</li>
</div><!--ssec-environ-->

<div class="subsection" id="ssec-download">
<h3>ダウンロード</h3>
<p>github のページから ZIP アーカイブがダウンロードできる。
<ul>
<li><a href="https://github.com/zr-tex8r/PXmonja">zr-tex8r/PXmonja</a>
サイトメニューにある「Download ZIP」のボタンを押す。
</li>
</ul>
</div><!--ssec-download-->

</div><!--sec-overview-->

<div class="section" id="sec-usage">
<h2>基本的な使い方</h2>

<p>dvipdfmx を用いる場合は、
等幅出力に使う日本語フォントをパッケージオプションで指定できる。
（ファイル名で指定する。
TTC ファイルの場合は例えば <code>font=:0:msgothic.ttc</code> のようにする。）
既定（あるいは <code>font=*</code> 指定）では非埋込となる。
</p>
<pre>
\usepackage[font=&lt;フォントファイル名&gt;]{pxmonja}
</pre>
<p>dviout ではこの指定は無効になり、マップファイル（dviout-pxmonja.map）
で指定したものが常に使われる。
</p>


<div class="subsection" id="ssec-verbatim">
<h3>Verbatim 出力を等幅にする</h3>

<p>パッケージを読み込むと、
verbatim 出力（verbatim<code>(*)</code> 環境と <code>\verb(*)</code> 命令）
が等幅になる。
</p>
<pre>
\documentclass[a4paper]{jsarticle}
\usepackage[font=ipag.otf]{pxmonja} % IPAゴシック(ver.003)を指定
\begin{document}
この \verb|\multicolumn| 命令は、\verb|<列数>| を1に指定した形でも
よく使われる。セルの連結はせず、セル内の文字の配置だけを変更する
場合に有用である。以下に例を示す。
\begin{quote}\small
%=============================== 例はじめ
\begin{verbatim}
\newcommand*{\Aligned}{\multicolumn{1}} % \Aligned{配置}{セル内容}
\begin{center}\small\begin{tabular}{c|l|l|l}
\hline                              % ヘッダ行 -------------------------
名称 & \Aligned{c|}{開発者} & \Aligned{c|}{\pTeX}   % ヘッダセルは
  & \Aligned{c}{動作環境}\\                         % 中央揃え
\hline                              % 本体 -----------------------------
{\TeX} Live  & Karl Berry（現在）  & 無 & UNIX、Windows   \\
te{\TeX}     & Thomas Esser        & 無 & UNIX            \\
Mik{\TeX}    & Christian Schenk    & 有 & Windows         \\
W32{\TeX}    & 角藤 亮             & 有 & Windows         \\
ptexlive     & 土村 展之           & 有 & UNIX            \\
\hline % Mac OS X は UNIX だ        % ----------------------------------
\end{tabular}\end{center}
\end{verbatim}
%================================ 例おわり
\end{quote}
\end{document}
</pre>
<div align="center" class="display">
<div class="imagebox" style="width:938px">
<img src="sample/pxmonja-sample01.png" width="938" height="421">
</div></div>


<div class="alert"><span class="lbl">注意：</span> 
パッケージオプションに <code>noverbatim</code> を指定すると
verbatim のフォントの変更は行われない。
この場合も、後述の <code>\monjabox</code> 等は使用できる。
</div>

<div class="bend"><span class="lbl">参考：</span> 
上の例で pxmonja がないと次のような出力になる。
<div align="center" class="display">
<div class="imagebox" style="width:939px">
<img src="sample/pxmonja-sample02.png" width="939" height="419">
</div></div>
ちなみに、この Web ページ上の文書ソースのテキスト表示が
「等幅」になっているかは、ブラウザのフォント設定に依存する。
</div>



</div><!--ssec-verbatim-->

<div class="subsection" id="ssec-verbatim">
<h3>Verbatim 出力以外での等幅出力</h3>

<ul>
<li><code>\monjabox{&lt;テキスト&gt;}</code>： 
ボックス（<code>\mbox</code>）に入れた形で <code>&lt;テキスト&gt;</code>
を等幅で出力する。
（途中で改行できない。）
</li>
<li><code>\begin{monja}～\end{monja}</code>： 
中身を等幅で出力する。
前後に改段落が入る。
</li>
</div>
<div class="alert"><p><span class="lbl">注意：</span> 
pTeX の仕様のため、段落の一部だけを等幅にしようとすると、
その部分をボックスに入れる必要が生じる。
</p>
<p>詳しく述べると、等幅にするには、フォントを切り替えるだけでは不十分で、
和文間および和欧文間の空白の自動挿入を無効にする
（<code>\noautospacing</code>／<code>\noautoxspacing</code>）
必要があり、この設定は段落／ボックス単位でしか変更できないからである。
ただし、フォントを切り替えるだけの命令 <code>\domonja</code>
も用意していて、以上の制限を踏まえて使えば有用な場合もある
（例えば minipage 環境の先頭で実行する、等）。
</p>



</div><!--ssec-verbatim-->

</div><!--sec-usage-->

<div class="section" id="sec-package">
<h2>Verbatim 拡張のパッケージと併用する</h2>

<p>PXmonja パッケージの等幅の処理は、verbatim 出力機能には
（フォント指定を除いて）手を加えていないので、
他の verbatim 出力用のパッケージと併用して、
そのパッケージの出力を和文等幅で行うことができる。
</p>

<div class="subsection" id="ssec-verbatim">
<h3>verbatim パッケージ</h3>

<p>LaTeX 標準の tools バンドルの構成の一つである、
verbatim パッケージの <code>\verbatiminput</code> を使用した例。
</p>
<pre>
\documentclass[a4paper]{jsarticle}
\usepackage[font=ipag.otf]{pxmonja}
\usepackage{verbatim}\pagestyle{empty}
\begin{document}
\begin{quote}\small
\verbatiminput{list.pl} % 文字コードは LaTeX 文書に合わせる
\end{quote}
\end{document}
</pre>
<p id="elt-list-pl">（ファイル list.pl の内容）
</p>
<pre>
open(IN, '&lt;', 'user.tsv') or die;
while (&lt;IN&gt;) {
  chomp; @flds = split(m/\t/, $_);
  print &lt;&lt;END;
ユーザID        = $flds[0] 
氏名            = $flds[1]
氏名(ふりがな)  = $flds[2]
メールアドレス  = $flds[3]
PASSWORD        = $flds[4]
END
}
</pre>
<div align="center" class="display">
<div class="imagebox" style="width:314px">
<img src="sample/pxmonja-sample03.png" width="314" height="288">
</div></div>

</div><!--ssec-verbatim-->

<div class="subsection" id="ssec-jsverb">
<h3>jsverb／okuverb／bxjsverb パッケージ</h3>

<p>jsverb／okuverb パッケージは、奥村晴彦氏製作の
<a href="">「新ドキュメントクラス」</a>のアーカイブに含まれているパッケージ。
<a href="./bxptool.html">bxjsverb パッケージ</a>は jsverb を pLaTeX
以外でも使えるように私が改造したもの。
（ただし、pxmonja は （u）pLaTeX 専用である。）
</p>

<pre>
\documentclass[a4paper]{jsarticle}
\usepackage[font=ipag.otf]{pxmonja}
\usepackage{jsverb}
\begin{document}
\begin{verbatim}
open(IN, '&lt;', 'user.tsv') or die;
<a href="#elt-list-pl">……(中略)……</a>
}
\end{verbatim}
\end{document}
</pre>

</div><!--ssec-jsverb-->

<div class="subsection" id="ssec-moreverb">
<h3>moreverb パッケージ</h3>

<p>moreverb パッケージ（作者は Robin Fairbairns ほか）
の <code>\listinginput</code> を用いた例。
</p>
<pre>
\documentclass[a4paper]{jsarticle}
\usepackage[font=ipag.otf]{pxmonja}
\usepackage{moreverb}\pagestyle{empty}
\begin{document}
\begin{quote}\small
\listinginput{1}{<a href="#elt-list-pl">list.pl</a>}
\end{quote}
\end{document}
</pre>
<div align="center" class="display">
<div class="imagebox" style="width:360px">
<img src="sample/pxmonja-sample04.png" width="360" height="288">
</div></div>
<div class="alert"><span class="lbl">注意：</span> 
moreverb が提供するタブ展開付の verbatim 出力機能
（verbatimtab 環境、<code>\verbatimtabinput</code>）
を和文等幅出力と併用すると、
和文文字も 1 文字として数えるため、
タブ位置がずれてしまう。
次に述べる fancyvrb のタブ展開機能ではこの問題は起こらない。
</div>

</div><!--ssec-moreverb-->

<div class="subsection" id="ssec-fancyvrb">
<h3>fancyvrb パッケージ</h3>

<p>fancyvrb パッケージ（作者は Timothy Van Zandt, Denis Girou,
Sebastian Rahtz,Niall Mansfield）の提供する拡張 verbatim 出力機能
（Verbatim 環境、<code>\VerbatimInput</code> 命令、等）では、
出力に用いるフォントファミリを、オプションの <code>fontfamily</code>
キーで指定可能である。
そこで、<code>fontfamily=monja</code> によって pxmonja
の和文等幅フォントが使われるようにした。
タブ展開設定（<code>obeytabs</code> キー）
も正常に機能するようである。
（fancyverb のタブ展開は文字数でなく文字幅によってタブ位置を計算しているため。）
ただし fancyvrb の拡張機能が全て使えることは確認していないので、
出力結果に注意する必要がある。
<pre>
\documentclass[a4paper]{jsarticle}
\usepackage[font=ipag.otf]{pxmonja}
\usepackage{color}
\definecolor{verbnum}{rgb}{0,0.1,0.8}   % 行番号の色
\definecolor{verbframe}{rgb}{0,0.6,0}   % 枠線の色
\usepackage{fancyvrb}
\begin{document}
\noindent プログラム：
\renewcommand{\theFancyVerbLine}% 行番号出力の書式
  {\textcolor{verbnum}{\footnotesize\sffamily\arabic{FancyVerbLine}}}
\begin{quote}
\VerbatimInput[formatcom={\small\narrowbaselines},% \narrow... は jsarticle の命令
  fontfamily=monja,% フォントファミリを 'monja' に設定
  numbers=left,frame=single,rulecolor=\color{verbframe}%
]{list.pl}
\end{quote}
\noindent テストデータ：
\begin{quote}
\VerbatimInput[formatcom={\footnotesize},fontfamily=monja,%
  obeytabs=true,tabsize=16,% タブ幅を 16 にしてタブ展開
  frame=single,rulecolor=\color{verbframe}%
]{user.tsv}
\end{quote}
\end{document}
</pre>
<div align="center" class="display">
<div class="imagebox" style="width:940px">
<img src="sample/pxmonja-sample05.png" width="940" height="435">
</div></div>
<p>ここで、user.tsv は次のようなタブ区切りテキスト（TSV）
のデータファイルである。
（<code>&lt;TAB&gt;</code> はタブ文字を表す。）
<pre>
102008001335&lt;TAB&gt;時間泥棒&lt;TAB&gt;じかんどろぼう&lt;TAB&gt;zr@vapor.net&lt;TAB&gt;H4ppy#73X1n'
992008000001&lt;TAB&gt;管理者1&lt;TAB&gt;かんりしゃ1&lt;TAB&gt;admin1@x-vulnerable.net&lt;TAB&gt;password
</pre>

</div><!--ssec-fancyvrb-->

</div><!--sec-package-->

</div><!--maintext-->

<div id="navibar-sub">
<div class="rightpart">
<a href="#canvas">先頭へ</a>
</div>
<div class="leftpart">
<span class="navilang">
| <span class="na">en</span>
| <span class="here">ja</span> |
</span>&nbsp;
<a href="./index.html">トップ</a> &gt;
<span class="here">PXmonja パッケージ</span>
<div class="clearright"></div>
</div>
</div><!--navibar-sub-->
<div id="footer">
<div id="counter-mini"></div>
<div id="copyright">
Copyright &copy; 2010&#x2013;2016 ZR (Takayuki YATO)<br>
Last updated: 2016-02-14
</div>

</div><!--footer-->

</div><!--main-->
</div><!--***********************************************************-->
</body>
</html>
